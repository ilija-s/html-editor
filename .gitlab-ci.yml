image: ubuntu:latest

stages:
  - before_script
  - build
  - test


before_script:
  - apt-get update -y
  - apt-get install -y build-essential
  - apt-get install -y qt6-base-dev
  - qtchooser -install qt6 $(which qmake6)
  - mv ~/.config/qtchooser/qt6.conf /usr/share/qtchooser/qt6.conf
  - mkdir -p /usr/lib/$(uname -p)-linux-gnu/qt-default/qtchooser
  - ln -n /usr/share/qtchooser/qt6.conf /usr/lib/$(uname -p)-linux-gnu/qt-default/qtchooser/default.conf
build:
  stage: build
  script:
    - qmake ./HTML_editor.pro
    - make -j$(nproc)

test:
  stage: test
  script:
    - cd test
    - for dir in */; do
        if [[ $dir == *Test/ ]]; then
          cd $dir;
          qmake;
          make;
          ./$(basename $dir)Test;
          cd ..;
        fi
      done
